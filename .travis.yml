dist: xenial
services: docker

language: python
python:
  - '3.6'

env:
  global:
    secure: 'tv+TH7Kuzus5C7m855nrXijMNz5lDavV7FM/UUsoAj92CdBXM0BqnlG/gokgMwMRvPEjAz4Ppgfu0WcukAujFd9UJ2VDLWCYLoHfIf731Rv8U5TFJSCq/B34QVCvP85JkAWc+rMfr7NPDFVzXh1CZxRVQLQZrGMRl1QS9RVhSYsIo572EICQQ8R4XgWJ2m5SbT17M5xiit0IF9RCI+NNzhiM4BnpFZ4iWN7DmKWkXOvnjUtJ5262tHhKXHHQ9A9NdOiofRxnwqYmmfEe8TjH0Hi1uLIgIViBuAI0/RZiH+3OK/D8lZ8gtSLOKTmBvdvf24+lCk3wbgS7Q6I4HShdlk3drnbxmRnoPEVH6YS2fA78rNspYT0sc+MwINoI+BQaeah9HGqykhxdHTlE9nqm8ialEtkh0m8W4QG/dI93kR4pv+Fz/x/bXoqubsPfpKeZq1sDnS8esrg+LYcx1EYKfjqmLGHQzoHSgl4y5bY17yU9suZJCKHXkL2cCmTawLdJYE1Yk6Y0JbWZBViMUA1WtCwQ8IMROrzMDuY0xL0HNO0S9+0uGE7XsRv+36yF0GU/KGw7QurVWnsAkxxZasscDYnFU4XfnTAkhTgtfuSVwlpy8VQBoAT9HDNli7g3od24XdgVuwi57WacDiWe88YNPacd0GXwBqRtLcFOhyvvb/8='
    secure: 'tWGFGsfWbUV0zZJrXcj4ncROHaI0k2rVNJVM1P/pNV0Lyp5w5NwsDZljK0xsP9oNA1oq6i5k/D2DQiqfNSNzCG9DlOuHKLJ68qdWG7V4IKbYPNzeoJVSefbqok1ITzIcSxNw2GFXpCTF2ZlVH6+2o3/B9AicbYpc8TK0yDpij3YptTG1dn7Js8wvjOlWyfZ1T5jOJzPPTjI8NMWX8+axAlTK4wr/eg4fmDlR5y76edD9tvCTXuLFcMbvbuw0s+G58i8GKGiwe+tC1ab9xUwIrYmUB9X/v8/ZhGIXDShtltpNYZ34870dSec1HSFVLKH7zU+4RRy8dI0wouszpqr36Jo2wfv8RHeOBPWoExNEI6tG4JwFtwwkMZUSqa+iStMi5EO67kvHamVNc5jfBuf4l2/Cj81ouAb+docPgK3Qjsj9aVjGjSsj3F9ExautGZHv7zCKixrAm11/uSkvFJ5quu1jDnWaIWOEht7BBcWTFu/NMSil02g4Pi3YE0GMqVd1PPnry2646XHZs9FEmjPpgctcmGqISiivrNu8RLDWqAtkz2k87BmKxj/5a9MkFMlqf81TJlpzCMBxq9F/zdiqsqMnSMF11jKEBb8ffJYvFJPgFbPkseSI7a2lOworgkdiphL0GF16BZEm2b4lObIZlinpm4w0Av4oqRyIziGCCAY='

before_install:
  - curl --retry 5 -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
  - travis_retry sudo apt-get update
  - travis_retry sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce
  - docker version

install:
  - travis_retry pip install -q docker molecule openshift jmespath

script:
  - molecule test -s test-local

after_success:
  - travis_retry docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"
  - export IMAGE_TAG="$(./build-script-collection/get-version-git | tr '+' '_')"
  - docker build -f build/Dockerfile -t "elementalnet/ceph-osd-operator:$IMAGE_TAG" .
  - travis_retry docker push "elementalnet/ceph-osd-operator:$IMAGE_TAG"
